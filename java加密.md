# Java如何加密

严格意义上将所有开发语言都可以对自身进行加密，但是对于编译型语言简单，对于解释型语言来说对其自身的加密将会带来很多额外复杂的工作。

## 什么是解释型语言什么是编译型语言？

### 解释型语言

解释型语言是无需编译即可运行在特定环境上的语言，最直接的是javascript，任何js代码都可以直接运行在浏览器中。任何一个网页，检查源码时都可以看到其js源码（至于源码能不能直观，这是另一个话题这个叫代码混淆）

### 编译型语言

编译型语言很简单就是C语言，C语言只有源码后编译后的二进制文件。编译生成后的和源码已经是完全不同的两个东西，一个是字符串一个是二进制。

### 为什么我说java是解释型语言？

Java属于解释型，也不属于解释型，属于编译型，也不属于编译型。
解释型不需要编译，但是javac却把Java源码变异成了.class的二进制，但是.
class中的二进制又不像C编译后的纯粹的平台相关的二进制，
一切.class都必将运行在虚拟机上。因此我将它称为解释型语言。

严格意义上Java既不属于解释型语言也不属于编译型语言，主要看你是怎么人为。

## 为什么要做加密？

**归纳为一句话：一切都是为了不让别人看到自己的源码。**

这里说的加密指的是交付后产物的加密。什么是交付后加密？源码在程序员开发整个生命周期中存在。除了开源项目，没人会将源码进行交付，最终交付用户的都是非源码。

但是，编程界存在一个技术叫做反编译。对于非编译型语言如JavaScript，已经可以直接看到源码，所以大家最多是对代码进行混淆，对于编译型语言如C都是利用一些无法反编译的额外条件对源码进行加密。

最终目的，都是想让自己的代码不让别人看到。最常见的是商业上收费使用，但是又不会被复制一份，保证自身的商业利益。

## 为什么解释型语言不好做加密？

因为解释型语言都运行在某一个特定的环境中。

对于JavaScript来说运行在浏览器中，如果你对它进行加密，加密后浏览器不认识，那它就不能运行。 对于java来说运行在jvm中，加密编译后的.class文件会使.class发生本质改变，jvm也将不认识新的二进制文件，代码同样不能运行。

这就是问题的根本点，解释型语言依赖于某个特定平台，贸然加密将导致平台无法运行目标程序。
除非平台对外提供相应回调接口供外部使用。而这部分接口，基本上都是需要使用c或者C++进行开发。很简单，因为已经深入到了底层，底层肯定是c或者c++开发。

## Java的加密

> 我默认你已经是一个有经验的Java工程师，简单问题将不会深入。

### 前置条件一：class文件的基本结构
[官方解释的class文件的基本结构](https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-4.html)

### 前置条件二：JVMTI

JVMTI（Java Virtual Machine Tool Interface）即指 Java 虚拟机工具接口，它是一套由虚拟机直接提供的 native 接口，它处于整个 JPDA 体系的最底层，所有调试功能本质上都需要通过 JVMTI 来提供。
通过这些接口，开发人员不仅调试在该虚拟机上运行的 Java 程序，还能查看它们运行的状态，设置回调函数，控制某些环境变量，从而优化程序性能。
JVMTI 本质上是在 JVM 内部的许多事件进行了埋点。通过这些埋点可以给外部提供当前上下文的一些信息。甚至可以接受外部的命令来改变下一步的动作。
外部程序一般利用C/C++实现一个JVMTIAgent，在Agent里面注册一些JVM事件的回调。当事件发生时JVMTI调用这些回调方法。Agent可以在回调方法里面实现自己的逻辑。JVMTIAgent是以动态链接库的形式被虚拟机加载的。

### 前置条件三：jvm类加载顺序

加载、验证、解析、初始化，jvmti执行时机






